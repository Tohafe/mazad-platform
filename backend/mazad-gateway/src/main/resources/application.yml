spring:
  application:
    name: mazad-gateway

  config:
    import: optional:file:../../.env[.properties]

  cloud:
    gateway:
      server:
        webflux:
          default-filters:
            - AddRequestHeader=X-Source, Mazad-Gateway

          routes:
            - id: item-service-route
              uri: http://items-service:${ITEMS_SERVICE_PORT}
              predicates:
                - Path=/api/v1/items/**, /api/v1/categories/**
              filters:
                - name: ApiKeyFilter
                - name: RequestRateLimiter
                  args:
                    redis-rate-limiter.replenishRate: 1
                    redis-rate-limiter.burstCapacity: 2
                    redis-rate-limiter.requestedTokens: 1
                    key-resolver: "#{@resolveKey}"

            - id: auth-service-route
              uri: http://auth-service:${AUTH_SERVER_PORT}
              predicates:
                - Path=/api/v1/auth/**
              filters:
                - StripPrefix=2

            - id: user-service-route
              uri: http://user-service:${USER_SERVER_PORT}
              predicates:
                - Path=/api/v1/profile/**
              filters:
                - StripPrefix=2

            - id: bidding-service-route
              uri: http://bidding-service:${BIDDING_SERVICE_PORT:8081}
              predicates:
                - Path=/api/v1/bids/**
              filters:
                - StripPrefix=2
